var appointments,global,buttons,dropdown,textInput,subheader,modal,cssBezier=new Ease(new BezierEasing(.7,0,.3,1)),pages={current:"NA",init:function(t){var e=pages.list.appointmentsListView;for(var n in pages.list){var o=pages.list[n];o.hash===window.location.hash.substring(1)&&(e=o)}e.init(t)},gotoPage:function(t,e){$(t.container).load(t.url,function(){$(window).scrollTop(0),$(".loading-page").removeClass("loading"),window.location.hash.substr(1)!==t.hash&&pages.updateHash(t.hash),pages.current=t.hash;var n=$("body").attr("class").split(" ");$("body").attr("class",n[0]),$("body").addClass(t.hash),e&&e()})},updateHash:function(t){window.location.hash.substr(1)!==t?window.location.hash=t:pages.init(!0)},list:{appointmentsListView:{container:".page-content",url:"pages/appointmentsListView.html",hash:"listView",init:function(t){$(".loading-page").addClass("loading");var e=function(){pages.gotoPage(pages.list.appointmentsListView,function(){buttons.renderButtons(),dropdown.renderDropdowns(),$.get("partial/_listdate.html",function(t){var e=$(t);$(".list-wrap").append(e);for(var n=appointments.startingWeek,o=0;o<$(".date-row").length;o++){var a=$(".date-row").eq(o),s=appointments.dateStrToObj(n);a.attr("id",s.dateNoHyphens),a.find(".written-out").html(s.dateString),n=appointments.incrementDate(n)}}),null===appointments.appts&&appointments.loadAppointments(function(){var t=appointments.getAppointmentsByDaySorted(appointments.appts);for(var e in t)if(1===$(".date-row#"+e).length){var n=t[e],o={appointments:n};global.render(o,"appointments-list-item",$("#"+e+" .appointments-wrapper"))}subheader.scrollHelper($("html").scrollTop())})})},n=t?500:0;setTimeout(function(){e()},n)}}}};global={transistionEnd:"webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",breakpts:{sml:710,med:1010,lrg:1490},breakpt:function(){var t=window.innerWidth,e="lrg";for(var n in global.breakpts)if(global.breakpts[n]>=t){e=n;break}return e},pxToInt:function(t){var e=t.split("px")[0];return parseInt(e)},strToCamelCase:function(t){t=t.toLowerCase();var e=t.split(" ");if(1===e.length)return t;for(var n=e[0],o=1;o<e.length;o++)n+=e[o].charAt(0).toUpperCase()+e[o].slice(1);return n},decimalToTime:function(t){var e=Math.floor(t),n="am",o=Math.floor(t%1*60);return o=o<10?"0"+o:o,e>=12&&(e=12===e?e:e%12,n="pm"),e+":"+o+n},scrollTo:function(t,e,n){var o=t.offset().top-115;"listView"===pages.current&&(o=t.offset().top-115-53);var a=0;(void 0===e||e)&&(a=500),$("html,body").animate({scrollTop:o},a,function(){void 0!==n&&n()})},toTitleCase:function(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},shuffleArray:function(t){for(var e=t.length,n,o;0!==e;)o=Math.floor(Math.random()*e),e-=1,n=t[e],t[e]=t[o],t[o]=n;return t},toggleGrid:function(){$(".grid").toggleClass("off")},closeEverything:function(){dropdown.closeAll(),$(".action-dropdown.expanded").each(function(){buttons.closeActionButton($(this).siblings(".button"))})},toggleSlideout:function(){$(".slideout").hasClass("collapsed")?global.openSlideout():global.closeSlideout()},openSlideout:function(){$(".slideout").removeClass("collapsed"),$("body").addClass("locked")},closeSlideout:function(){$(".slideout").addClass("collapsed"),$("body.locked").removeClass("locked");var t=$(".appt-wrapper.selected").attr("id"),e=_.findWhere(appointments.appts,{_id:t});appointments.redrawAppointmentRow(e),$(".appt-wrapper.selected").removeClass("selected")},render:function(t,e,n,o,a){o=void 0===o||o,$.get("templates/_"+e+".html",function(e){Handlebars.registerHelper("eq",function(t,e){return t===e}),Handlebars.registerHelper("decimalToTime",function(t){return global.decimalToTime(t)}),Handlebars.registerHelper("shouldHaveTooltip",function(t,e){return"active"!==t||e}),Handlebars.registerHelper("convertProviderName",function(t){return t.toLowerCase().replace(/\s/g,"-")});var s=Handlebars.compile(e),i=s(t);void 0!==a&&a(),void 0!==n&&(o?$(n).html(i):$(n).append(i))})}},appointments={appts:null,daysInMonths:[31,28,31,30,31,30,31,31,30,31,30,31],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dow:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],startingWeek:"2017-09-24 Sunday Sep.",today:"2017-09-28 Thursday Sep.",durationSettings:{sick:{new:.75,returning:.5},physical:{new:1,returning:.75},pregnancyVisit:{new:1,returning:.5},wellWomanExam:{new:.75,returning:.5}},dateStrToObj:function(t){var e=t.split(" ");return{dateWithHyphens:e[0],dateNoHyphens:parseInt(e[0].replace(/-/g,"")),dateString:e[2]+" "+e[0].split("-")[2]+", "+e[0].split("-")[0],dayOfWeek:e[1],dayOfWeekShort:e[1].substr(0,3),month:e[2]}},getAppointmentsByDaySorted:function(t){var e=_.groupBy(t,function(t){return t.date.split(" ")[0].replace(/-/g,"")});for(var n in e){var o=e[n];e[n]=_.sortBy(o,function(t){return t.startTime})}return e},incrementDate:function(t,e){e=void 0===e?1:e;var n=t.split(" "),o=new Date(n[0]);return o.setDate(o.getDate()+e+1),o.getFullYear()+"-"+(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1)+"-"+(o.getDate()<10?"0"+o.getDate():o.getDate())+" "+appointments.dow[o.getDay()]+" "+appointments.monthsShort[o.getMonth()]+"."},durationByApptAndPatient:function(t){var e=global.strToCamelCase(t.type),n=t.member.newPatient?"new":"returning";return appointments.durationSettings[e][n]},determineStatus:function(t){var e=appointments.dateStrToObj(appointments.today).dateNoHyphens,n=appointments.dateStrToObj(t.date).dateNoHyphens,o=e>n;return o||(t.noShow=!1,t.lateCancel=!1),t.noShow?(t.lateCancel=!1,t.canceled=!1,"no-show"):(t.canceled=t.lateCancel||t.canceled,t.canceled?"canceled":o?"complete":"booked")},toggleBooleanToggleSwitch:function(t,e){var n=t[e],o=!n;t[e]=o,$(".toggleSwitch."+e).siblings(".toggleSwitchTextWrap").removeClass(""+n).addClass(""+o)},typeReasonToFields:function(t){var e=t.typeReason.split("-");t.type=e[0],t.reasonForVisit=e[1]},redrawAppointmentRow:function(t){var e=t._id;t.status=appointments.determineStatus(t);var n=$(".appt-wrapper#"+e),o={appointments:[t]};$.get("templates/_appointments-list-item.html",function(t){Handlebars.registerHelper("eq",function(t,e){return t===e}),Handlebars.registerHelper("decimalToTime",function(t){return global.decimalToTime(t)}),Handlebars.registerHelper("shouldHaveTooltip",function(t,e){return"active"!==t||e}),Handlebars.registerHelper("convertProviderName",function(t){return t.toLowerCase().replace(/\s/g,"-")});var e=Handlebars.compile(t),a=e(o),s=$("<div />");s.html(a);var i=s.find(".appt-wrapper").html();n.html(i)})},loadAppointments:function(t){$.getJSON("js/json/appointments.json",function(e){for(var n=e.appointments,o=0;o<n.length;o++)appointments.typeReasonToFields(n[o]),n[o].duration=appointments.durationByApptAndPatient(n[o]),n[o].endTime=n[o].startTime+n[o].duration,n[o].status=appointments.determineStatus(n[o]),n[o].potentialNoShow=!n[o].member.newPatient&&n[o].potentialNoShow,n[o].dateObject=appointments.dateStrToObj(n[o].date),n[o].provider.addressLine1=n[o].provider.address.split(",")[0],n[o].provider.addressLine2=n[o].provider.address.split(",")[1];appointments.appts=e.appointments,void 0!==t&&t()})}},buttons={inputSizeMap:{closed:{xsmall:"medium",small:"large",medium:"xlarge"},open:{xsmall:"medium",small:"medium",medium:"large"}},renderButtons:function(t,e){var n=void 0!==e?e.find(".partial.button"):$(".partial.button");n.each(function(e){var o=$(".partial.button")[e],a=$(o),s=a.attr("data-theme"),i=a.attr("data-size"),l=a.attr("data-text"),d=void 0!==a.attr("data-icon")?a.attr("data-icon").split(" "):[],r=a.attr("data-state"),p=void 0!==a.attr("data-custom-style")?a.attr("data-custom-style"):"",c=void 0!==a.attr("data-actions")?a.attr("data-actions").split(","):"",u=void 0!==a.attr("data-actionicons")?a.attr("data-actionicons").split(","):"";$.get("partial/_button.html",function(o){var m=$(o);if(m.addClass(s+" "+i+" "+r+" "+p),"icon-only"===r||"icon-only-action"===r){var h=$("<div />",{class:"button-icon-wrap icon-"+d[0]});d.length>1&&h.addClass(d[1]);var g="medium";"small"===i&&(g="small"),h.addClass("icon-"+g),m.find(".button").html(h)}else if("icon"===r){var f=$("<div />",{class:"icon-wrap icon-"+d[0]});d.length>1&&f.addClass(d[1]);var v="small";"xlarge"===i&&(v="medium"),f.addClass("icon-"+v),m.find(".button").html(f).append(l)}else m.find(".button").html(l);if("action"===r||"icon-only-action"===r){for(var w=$("<div />",{class:"action-dropdown"}),b=0;b<c.length;b++){var C=$("<div />",{class:"button-action",html:"<div class='action-title'>"+c[b]+"</div>"});u.length>0&&C.addClass("icon "+u[b]),w.append(C)}m.prepend(w)}a.parent().append(m),n.length-1===e&&(n.remove(),void 0!==t&&t())})})},toggleActionButton:function(t){t.siblings(".action-dropdown").hasClass("expanded")?global.closeEverything():(global.closeEverything(),buttons.openActionButton(t))},openActionButton:function(t){var e=t.siblings(".action-dropdown"),n=e.find(".button-action"),o=global.pxToInt(e.css("padding-top"))+global.pxToInt(e.css("padding-bottom"))+2;n.each(function(){o+=$(this).outerHeight()}),e.offset().top+o>$(window).height()?e.addClass("goUp"):e.removeClass("goUp"),e.offset().left-e.width()<50?e.addClass("goRight"):e.removeClass("goRight"),e.addClass("expanded"),TweenLite.to(e,.2,{height:o})},closeActionButton:function(t){var e=t.siblings(".action-dropdown");e.removeClass("expanded"),TweenLite.to(e,.2,{height:"100%"})}},dropdown={close:function(t){t.removeClass("expanded"),t.find(".typeaheadInput").blur()},closeAll:function(){dropdown.close($(".dropdown.expanded"))},open:function(t){global.closeEverything(),t.addClass("expanded"),t.find(".typeaheadInput").length>0&&(t.parents(".dd").hasClass("noheader")&&t.find(".typeaheadInput").val(""),t.find(".typeaheadInput").focus())},toggle:function(t){t.hasClass("expanded")?dropdown.close(t):dropdown.open(t)},selectOption:function(t,e){e.parents(".multi").length?(t.addClass("selected"),e.find(".view .selected").html(e.find(".option.selected").length+" selected")):(t.siblings(".selected").removeClass("selected"),t.addClass("selected"),0===t.children().length?e.find(".view .selected").html(t.text()):e.find(".view .selected").html(t.children(":first-child").text())),e.addClass("nonempty"),dropdown.close(e)},unselectOption:function(t,e){var n=e.parents(".multi").length;if(t.removeClass("selected"),n){0===e.find(".option.selected").length?(e.find(".view .selected").empty(),e.removeClass("nonempty")):e.find(".view .selected").html(NaN)}else e.find(".view .selected").empty(),e.removeClass("nonempty");dropdown.close(e)},renderDropdowns:function(t,e){var n="dropdown";$(".partial.typeahead").length>0&&(n="typeahead");var o=void 0!==e?e.find(".partial."+n):$(".partial."+n);o.each(function(e){var a=o[e],s=$(a),i=s.attr("data-theme"),l=s.attr("data-size"),d=s.attr("data-header"),r=s.attr("data-disabled")?"disabled":"",p=s.attr("data-selected"),c=s.attr("data-label"),u=s.attr("data-prompt"),m=s.attr("data-multi"),h=s.attr("data-options").split(","),g=s.attr("data-keys").split(","),f=s.attr("data-error")?s.attr("data-error"):"",v=s.attr("data-custom-style");v=void 0!==v?v:"",m=void 0!==m?"multi":"",$.get("partial/_"+n+".html",function(n){var a=$(n);a.addClass(i+" "+l+" "+d+" "+r+" "+v+" "+m),a.find(".label").html(c),a.find(".option-prompt").html(u),a.hasClass("typeahead")&&a.find("input.typeaheadInput").attr("placeholder",c);for(var w=0;w<h.length;w++){var b=$("<div />",{class:"option",key:""+g[w],html:""+h[w]});a.find(".options").append(b)}if(w<5&&a.addClass("lessthanfive"),void 0!==p){var C=a.find(".option[key='"+p+"']");C.addClass("selected"),a.find(".view .selected").html(C.text()),a.find(".dropdown").addClass("nonempty")}f.length>0&&(a.addClass("error"),a.find(".error-text").html(f),a.find(".error-text").removeClass("noshow")),s.parent().append(a),o.length-1===e&&(o.remove(),void 0!==t&&t())})})},searchTypeahead:function(t,e){for(var n=[],o=0;o<t.find(".option").length;o++){n[o]=t.find(".option").eq(o),n[o].addClass("noshow");var a=n[o].find(".query-match").contents();n[o].find(".query-match").replaceWith(a),n[o].html(n[o].text())}return _.filter(n,function(t){var n=t.text();if(n.toLowerCase().includes(e.toLowerCase())){t.removeClass("noshow");var o=n.toLowerCase().indexOf(e.toLowerCase()),a=o+e.length;return t.html(n.substring(0,o)+"<span class='query-match'>"+n.substring(o,a)+"</span>"+n.substr(a)),!0}return!1})}},subheader={initUnderline:function(){var t=$(".subheader-nav-item.sel").outerWidth(),e=$(".subheader-nav-item.sel").position().left-40;$(".subheader .underline").css("width",t).css("transform","translateX("+e+"px)")},selectNavItem:function(t){$(".subheader-nav-item.sel").removeClass("sel"),t.addClass("sel"),subheader.initUnderline()},scrollTo:function(t){var e=t.attr("key"),n=$(".subheadAnchor[key="+e+"]");global.scrollTo(n)},scrollHelper:function(t){var e=0;$(".subheader-nav-item").each(function(n,o){var a=$(o).attr("key"),s=$(".subheadAnchor[key="+a+"]").offset().top-115;"listView"===pages.current&&(s=$(".subheadAnchor[key="+a+"]").offset().top-115-53),s<=t&&(e=n)});var n=parseInt(e)+2;subheader.selectNavItem($(".subheader-nav-item:nth-child("+n+")"))}},modal={openModal:function(t,e,n,o){e=void 0!==e?e:"large",n=void 0!==n&&n,n?$(".modal-container").addClass("closeable"):$(".modal-container").removeClass("closeable"),$(".modal").removeClass("small large fullscreen").addClass(e+" "+t);var a;$.get("partial/_"+t+"-modal.html",function(t){a=$("<div />",{class:"modal-content",html:t}),$(".modal").append(a),buttons.renderButtons(),textInput.renderTextInputs(),dropdown.renderDropdowns(),"function"==typeof o&&o(),$(".modal-container").removeClass("closed"),$("body").addClass("locked")})},closeModal:function(){$(".modal-container").addClass("closed"),setTimeout(function(){$("body.locked").removeClass("locked"),$(".modal-content").remove(),$(".modal").attr("class","modal")},400)}},textInput={renderTextInputs:function(t,e){var n=void 0!==e?e.find(".partial.textInput"):$(".partial.textInput");n.each(function(e){var o=$(".partial.textInput")[e],a=$(o),s=a.attr("data-theme"),i=a.attr("data-size"),l=a.attr("data-header"),d=!!a.attr("data-disabled"),r=a.attr("data-label"),p=a.attr("data-value"),c=a.attr("data-error")?a.attr("data-error"):"";$.get("partial/_textInput.html",function(o){var u=$(o);u.addClass(s+" "+i+" "+l),u.find("label").text(r),u.find("input").attr("placeholder",r),void 0!==p&&u.find("input").val(p).addClass("nonempty"),d&&u.find("input").attr("disabled","true").addClass("disabled"),c.length>0&&(u.addClass("error"),u.find(".error-text").html(c),u.find(".error-text").removeClass("noshow")),a.parent().append(u),n.length-1===e&&(n.remove(),void 0!==t&&t())})})}},$(document).ready(function(){pages.init(!1),$.History.bind(function(){pages.init(!0)}),$(window).scroll(function(){var t=$("html").scrollTop();subheader.scrollHelper(t)}),$(window).resize(function(){setTimeout(function(){$(".action-dropdown.expanded").each(function(){$(this).offset().left+300>$(document).width()?$(this).addClass("goLeft"):$(this).removeClass("goLeft")})},500)}),Mousetrap.bind("ctrl+g",function(){global.toggleGrid()}),Mousetrap.bind("esc",function(){if(!$(".modal-container").hasClass("closed")&&$(".modal-container").hasClass("closeable"))return void modal.closeModal();global.closeSlideout()}),$(document).on("change",".fieldwrap input[type='text']",function(){$(this).val().length>0?$(this).addClass("nonempty"):$(this).removeClass("nonempty"),global.checkCompletion()}),$(document).on("mousedown",".option-prompt, .dropdown .view",function(t){clickX=t.clientX}),$(document).on("mousemove",".option-prompt, .dropdown .view",function(t){dragX=t.clientX}),$(document).on("click","input.typeaheadInput",function(t){t.stopPropagation()}),$(document).on("click",".fieldwrap.dd:not(.disabled), .option-prompt",function(t){if(t.stopPropagation(),!(Math.abs(clickX-dragX)>8)){var e=$(this).hasClass("dd")?$(this).find(".dropdown"):$(this).parents(".dd").find(".dropdown");dropdown.toggle(e)}}),$(document).on("click",".dd .option:not(.selected):not(.disabled)",function(t){t.stopPropagation(),dropdown.selectOption($(this),$(this).parents(".dropdown"))}),$(document).on("click",".dd .option.selected:not(.disabled)",function(t){t.stopPropagation(),dropdown.unselectOption($(this),$(this).parents(".dropdown"))}),$(document).on("click","body, form, .content",function(t){t.stopPropagation(),global.closeEverything()}),$(document).on("input","input.typeaheadInput",function(){var t=$(this);t.parents(".dropdown").addClass("loading"),setTimeout(function(){t.parents(".dropdown").removeClass("loading"),0===dropdown.searchTypeahead(t.parents(".typeahead"),t.val()).length?t.parents(".dropdown").addClass("empty"):t.parents(".dropdown").removeClass("empty")},Math.round(300*Math.random())+200)}),$(document).on("click",".buttonWrap.action .button, .buttonWrap.icon-only-action .button",function(t){t.stopPropagation(),buttons.toggleActionButton($(this))}),$(document).on("click",".xsmall.header .label",function(){$(this).siblings("input[type='text']").focus()}),$(document).on("click",".popover-text",function(t){t.stopPropagation(),$(this).siblings(".popover").toggleClass("closed");var e=$(this).offset().left,n=$(window).width();e+$(this).siblings(".popover").width()>n?$(this).addClass("flip"):$(this).removeClass("flip")}),$(document).on("click",".popover .close",function(t){t.stopPropagation(),$(this).parents(".popover").toggleClass("closed")}),$(document).on("click",".checkbox",function(t){t.stopPropagation()}),$(document).on("mouseover",".tooltip-icon",function(){var t=$(this).offset().left,e=$(window).width();t+$(this).siblings(".tooltip").width()>e?$(this).addClass("flip"):$(this).removeClass("flip")}),$(document).on("click",".subheader-nav-item",function(t){t.stopPropagation(),subheader.selectNavItem($(this)),subheader.scrollTo($(this))}),$(document).on("click",".modal",function(t){t.stopPropagation()}),$(document).on("click",".modal .close, .closeable",function(t){t.stopPropagation();var e=$(t.currentTarget);e.hasClass("modal")||e.parents(".modal").length>0&&!e.hasClass("close")||modal.closeModal()}),$(document).on("click",".toggle:not(.disabled) .toggle-btn:not(.sel)",function(t){t.stopPropagation(),$(this).parents(".toggle").find(".sel").removeClass("sel"),$(this).addClass("sel")}),$(document).on("click",".slideout .close",function(){global.closeSlideout()}),$(document).on("click",".toggleSwitch",function(){$(this).toggleClass("false"),$(this).toggleClass("true")}),$(document).on("click",".appt-wrapper",function(){var t=$(this).attr("id"),e={appointments:[_.findWhere(appointments.appts,{_id:t})]};$(".slideout").hasClass("collapsed")?($(this).addClass("selected"),global.render(e,"appointment-slideout",$(".slideout .slideoutContent"),!0,function(){global.openSlideout()})):$(this).hasClass("selected")?global.closeSlideout():(appointments.redrawAppointmentRow(_.findWhere(appointments.appts,{_id:t})),$(".appt-wrapper.selected").removeClass("selected"),$(this).addClass("selected"),TweenLite.to($(".slideoutContent"),.2,{alpha:0,ease:cssBezier,onComplete:function(){global.render(e,"appointment-slideout",".slideout .slideoutContent",!0,function(){TweenLite.to($(".slideoutContent"),.2,{alpha:1,ease:cssBezier})})}}))}),$(document).on("click",".provider-filter .dd .option",function(t){t.stopPropagation();var e=$(this).attr("key");$(".appointments-list").removeClass("all-doctors claudia-roberts-only karen-mcadoo-only"),$(".appointments-list").addClass(e)}),$(document).on("click",".toggleSwitch.noShow, .toggleSwitch.lateCancel",function(){var t=$(this).parents(".slideout-section.appointment").attr("data-id"),e=_.findWhere(appointments.appts,{_id:t});$(this).hasClass("noShow")?appointments.toggleBooleanToggleSwitch(e,"noShow"):$(this).hasClass("lateCancel")&&appointments.toggleBooleanToggleSwitch(e,"lateCancel")}),$(document).on("click",".slideout .cancelCTA",function(){modal.openModal("cancelAppointment","small",!0,function(){var t=$(".appt-wrapper.selected").attr("id"),e={appointments:[_.findWhere(appointments.appts,{_id:t})]};global.render(e,"cancel-appt-modal-datalist",$(".modal .appointment-summary"))})})});